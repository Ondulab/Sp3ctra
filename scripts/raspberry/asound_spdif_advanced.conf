# Advanced ALSA configuration for USB SPDIF - Sp3ctra optimized
# This configuration avoids conflicts between default and hw device access
# Place this file as /etc/asound.conf to use

# Define the USB SPDIF hardware device
pcm.usb_spdif_hw {
    type hw
    card 0          # USB SPDIF Adapter (card 0)
    device 0        # Device 0 (primary output)
}

# Define USB SPDIF with software mixing capability
pcm.usb_spdif_dmix {
    type dmix
    ipc_key 1024
    slave {
        pcm "usb_spdif_hw"
        rate 48000
        channels 2
        period_time 0
        period_size 200     # Match AUDIO_BUFFER_SIZE in config.h
        buffer_time 0  
        buffer_size 800     # 4 * period_size for stability
    }
    bindings {
        0 0     # Left channel
        1 1     # Right channel
    }
}

# Define USB SPDIF with plug layer for format conversion
pcm.usb_spdif_plug {
    type plug
    slave.pcm "usb_spdif_dmix"
    slave.rate 48000
    slave.channels 2
}

# Default PCM - route to USB SPDIF with plug layer
pcm.!default {
    type plug
    slave.pcm "usb_spdif_plug"
}

# Control interface for the USB SPDIF
ctl.!default {
    type hw
    card 0
}

# Named device for explicit USB SPDIF access
pcm.spdif {
    type plug  
    slave.pcm "usb_spdif_hw"
}

# Alternative direct access (for testing)
pcm.usb_direct {
    type hw
    card 0
    device 0
}

# HINT definitions for applications
pcm_slave.usb_spdif {
    pcm "usb_spdif_hw"
    rate 48000
    channels 2
}

# Ensure USB SPDIF is preferred for audio applications
defaults.pcm.card 0
defaults.pcm.device 0
defaults.ctl.card 0
